<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë½‘ê¸° ê²Œì„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        body {
            font-family: 'Noto Sans KR', sans-serif;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        .glow-button {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }
        .glow-button:hover, .glow-button:active {
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.8);
            transform: translateY(-2px);
        }
        .currency-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        .gacha-button {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }
        .gacha-button:hover, .gacha-button:active {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(245, 87, 108, 0.4);
        }
        .point-button {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        /* ë“±ê¸‰ë³„ ë°°ê²½ìƒ‰ */
        .grade-common {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #495057;
        }
        .grade-rare {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
            color: white;
        }
        .grade-epic {
            background: linear-gradient(135deg, #9775fa 0%, #845ef7 100%);
            color: white;
        }
        .grade-legendary {
            background: linear-gradient(135deg, #ffd43b 0%, #fab005 100%);
            color: #495057;
        }
        .grade-unique {
            background: linear-gradient(45deg, #ff6b6b 0%, #feca57 16.66%, #48dbfb 33.33%, #0abde3 50%, #ff9ff3 66.66%, #54a0ff 83.33%, #5f27cd 100%);
            background-size: 400% 400%;
            animation: rainbow 3s ease infinite;
            color: white;
        }
        
        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid #fff;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 640px) {
            .currency-card {
                padding: 1rem;
                min-width: 120px;
            }
            .currency-card .text-3xl {
                font-size: 1.5rem;
            }
            .point-button {
                padding: 1rem 2rem;
                font-size: 1rem;
            }
            .gacha-button {
                padding: 1.25rem 2.5rem;
                font-size: 1.125rem;
            }
        }
        
        @media (max-width: 480px) {
            .currency-card {
                padding: 0.75rem;
                min-width: 100px;
            }
            .currency-card .text-3xl {
                font-size: 1.25rem;
            }
            .point-button {
                padding: 0.875rem 1.5rem;
                font-size: 0.875rem;
            }
            .gacha-button {
                padding: 1rem 2rem;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex flex-col items-center justify-center p-4">
    
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="loginScreen" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50">
        <div class="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl w-11/12 max-w-md p-6 text-center">
            <h1 class="text-3xl font-bold text-white mb-6">ğŸ’ ë³´ì„ ë½‘ê¸° ê²Œì„</h1>
            <p class="text-gray-300 mb-6">ê²Œì„ì„ ì‹œì‘í•˜ë ¤ë©´ ë¡œê·¸ì¸í•˜ì„¸ìš”</p>
            <button id="loginBtn" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 px-6 py-3 rounded-full text-white font-bold text-lg transition-all duration-300">
                ê²Œì„ ì‹œì‘
            </button>
            <div id="loginLoading" class="hidden mt-4 flex justify-center">
                <div class="loading-spinner"></div>
            </div>
            <div id="loginError" class="hidden mt-4 text-red-300 text-sm"></div>
        </div>
    </div>
    
    <!-- ë©”ì¸ UI ì˜ì—­ -->
    <div id="mainUI" class="transition-opacity duration-500 opacity-0">
        <!-- ì¬í™” í‘œì‹œ ì˜ì—­ -->
        <div class="flex gap-4 sm:gap-6 mb-8 sm:mb-12">
            <!-- í¬ì¸íŠ¸ -->
            <div class="currency-card rounded-2xl p-6 text-center text-white shadow-2xl">
                <div class="text-xs sm:text-sm font-medium opacity-80 mb-2">í¬ì¸íŠ¸</div>
                <div id="points" class="text-3xl font-bold">0</div>
            </div>
            
            <!-- í”„ë¦¬ì¦˜ -->
            <div class="currency-card rounded-2xl p-6 text-center text-white shadow-2xl">
                <div class="text-xs sm:text-sm font-medium opacity-80 mb-2">í”„ë¦¬ì¦˜</div>
                <div id="prisms" class="text-3xl font-bold">0</div>
            </div>
        </div>

        <!-- ê²Œì„ ë²„íŠ¼ ì˜ì—­ -->
        <div class="flex flex-col items-center gap-4 sm:gap-6">
            <!-- ìƒë‹¨ ë²„íŠ¼ë“¤ -->
            <div class="flex gap-4 items-center">
                <!-- í¬ì¸íŠ¸ íšë“ ë²„íŠ¼ -->
                <button id="earnPointsBtn" class="point-button glow-button px-8 py-3 rounded-full text-white font-bold text-lg shadow-2xl touch-manipulation">
                    âœ¨ í¬ì¸íŠ¸ íšë“ âœ¨
                </button>
                
                <!-- ì¸ë²¤í† ë¦¬ ë²„íŠ¼ -->
                <button id="inventoryBtn" class="bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 px-8 py-3 rounded-full text-white font-bold text-lg shadow-2xl touch-manipulation transition-all duration-300">
                    ğŸ’ ì¸ë²¤í† ë¦¬
                </button>
                
                <!-- ì„¤ì • ë²„íŠ¼ -->
                <button id="settingsBtn" class="bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 px-8 py-3 rounded-full text-white font-bold text-lg shadow-2xl touch-manipulation transition-all duration-300">
                    âš™ï¸ ì„¤ì •
                </button>
            </div>
            
            <!-- ìƒì  ë²„íŠ¼ -->
            <button id="shopBtn" class="gacha-button px-16 py-5 rounded-full text-white font-bold text-2xl shadow-2xl touch-manipulation">
                ğŸª ìƒì  ğŸª
            </button>
            
            <!-- ì¥ì°©ëœ ë³´ì„ í‘œì‹œ -->
            <div id="equippedGemDisplay" class="mt-4 bg-white bg-opacity-10 rounded-xl p-4 text-center text-white opacity-0 transition-all duration-300">
                <div class="text-sm opacity-80 mb-2">ì¥ì°©ëœ ë³´ì„</div>
                <div id="equippedGemIcon" class="text-3xl mb-2">ğŸ’</div>
                <div id="equippedGemName" class="font-bold mb-1">ë³´ì„ ì´ë¦„</div>
                <div id="equippedGemStats" class="text-sm opacity-80">ì½”ëŸ¬ìŠ¤ +1</div>
            </div>
        </div>

        <!-- ê²°ê³¼ ë©”ì‹œì§€ -->
        <div id="message" class="mt-6 sm:mt-8 text-center text-white font-medium text-base sm:text-lg opacity-0 transition-opacity duration-300 px-4"></div>
    </div>

    <!-- ë½‘ê¸° ëª¨ì…˜ í™”ë©´ -->
    <div id="gachaScreen" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 opacity-0 pointer-events-none transition-all duration-500">
        <div class="text-center">
            <!-- ì›ì„ ì´ë¯¸ì§€ -->
            <div id="gemstone" class="w-32 h-32 sm:w-40 sm:h-40 bg-gray-300 rounded-lg mx-auto mb-6 cursor-pointer transform transition-all duration-300 hover:scale-110 shadow-2xl flex items-center justify-center text-4xl">
                ğŸ’
            </div>
            <p id="gachaText" class="text-white text-lg sm:text-xl font-medium">ì›ì„ì„ í´ë¦­í•˜ì„¸ìš”!</p>
        </div>
    </div>

    <!-- ë“±ê¸‰ ê³µê°œ í™”ë©´ -->
    <div id="revealScreen" class="fixed inset-0 flex items-center justify-center z-50 opacity-0 pointer-events-none transition-all duration-1000">
        <div class="text-center">
            <div id="gradeText" class="text-6xl sm:text-8xl font-bold mb-4 drop-shadow-2xl"></div>
            <p id="revealMessage" class="text-white text-xl sm:text-2xl font-medium mb-8">ë“±ê¸‰ì´ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤!</p>
            <button id="continueBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-8 py-3 rounded-full text-white font-bold text-lg transition-all duration-300">
                ê³„ì†í•˜ê¸°
            </button>
        </div>
    </div>

    <!-- ë³´ì„ íšë“ í™”ë©´ -->
    <div id="gemRewardScreen" class="fixed inset-0 flex items-center justify-center z-50 opacity-0 pointer-events-none transition-all duration-1000 bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900">
        <div class="text-center max-w-4xl w-full px-4">
            <!-- ë‹¨ì¼ ë³´ì„ í‘œì‹œ -->
            <div id="singleReward" class="hidden">
                <div id="rewardGemImage" class="w-24 h-24 sm:w-32 sm:h-32 bg-yellow-400 rounded-full mx-auto mb-6 shadow-2xl flex items-center justify-center text-3xl sm:text-4xl">
                    ğŸ’
                </div>
                <div id="rewardText" class="text-4xl sm:text-6xl font-bold text-white mb-8 drop-shadow-2xl">ë³´ì„ íšë“!</div>
            </div>
            
            <!-- ë‹¤ì¤‘ ë³´ì„ í‘œì‹œ -->
            <div id="multipleReward" class="hidden">
                <div class="text-4xl sm:text-6xl font-bold text-white mb-8 drop-shadow-2xl">10ê°œ ë³´ì„ íšë“!</div>
                <div id="multipleGemGrid" class="grid grid-cols-5 gap-4 mb-8 max-w-2xl mx-auto">
                    <!-- 10ê°œ ë³´ì„ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
            
            <button id="finalContinueBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-8 py-3 rounded-full text-white font-bold text-lg transition-all duration-300">
                í™•ì¸
            </button>
        </div>
    </div>

    <!-- ìƒì  ë©”ì¸ í™”ë©´ -->
    <div id="shopScreen" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 opacity-0 pointer-events-none transition-all duration-500">
        <div class="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl w-11/12 max-w-md p-6">
            <!-- ìƒì  í—¤ë” -->
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl sm:text-3xl font-bold text-white">ğŸª ìƒì </h2>
                <button id="closeShopBtn" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-full text-white font-bold transition-all duration-300">
                    âœ• ë‹«ê¸°
                </button>
            </div>
            
            <!-- ìƒì  ë©”ë‰´ -->
            <div class="space-y-4">
                <button onclick="openGachaShop()" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 px-6 py-4 rounded-xl text-white font-bold text-lg transition-all duration-300 flex items-center justify-center gap-3">
                    â›ï¸ ì›ì„ ì±„êµ´ì¥
                </button>
                <button onclick="openVolumeShop()" class="w-full bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 px-6 py-4 rounded-xl text-white font-bold text-lg transition-all duration-300 flex items-center justify-center gap-3">
                    ğŸ“¦ ë³¼ë¥¨ ìƒì 
                </button>
            </div>
        </div>
    </div>

    <!-- ì›ì„ ì±„êµ´ì¥ í™”ë©´ -->
    <div id="gachaShopScreen" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 opacity-0 pointer-events-none transition-all duration-500">
        <div class="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl w-11/12 max-w-2xl max-h-[90vh] p-6 flex flex-col">
            <!-- ì±„êµ´ì¥ í—¤ë” -->
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl sm:text-3xl font-bold text-white">â›ï¸ ì›ì„ ì±„êµ´ì¥</h2>
                <button id="closeGachaShopBtn" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-full text-white font-bold transition-all duration-300">
                    âœ• ë‹«ê¸°
                </button>
            </div>
            
            <!-- ë½‘ê¸° ëª©ë¡ -->
            <div class="space-y-4 overflow-y-auto flex-1 pr-2">
                <!-- ì´ˆì‹¬ìì˜ ì›ì„ -->
                <div class="bg-white bg-opacity-5 rounded-xl p-4 flex justify-between items-center">
                    <div>
                        <h3 class="text-lg font-bold text-white mb-1">ğŸª¨ ì´ˆì‹¬ìì˜ ì›ì„</h3>
                        <p class="text-gray-300 text-sm">ê¸°ë³¸ì ì¸ ë³´ì„ì´ ë‚˜ì˜¤ëŠ” ì›ì„ì…ë‹ˆë‹¤</p>
                        <p class="text-blue-300 font-medium">ğŸ’° 10 í¬ì¸íŠ¸ | ğŸ’° 100 í¬ì¸íŠ¸ (10íšŒ)</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="startGacha('beginner')" class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-full text-white font-bold transition-all duration-300">
                            1íšŒ ë½‘ê¸°
                        </button>
                        <button onclick="startGacha('beginner', 10)" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-full text-white font-bold transition-all duration-300">
                            10íšŒ ë½‘ê¸°
                        </button>
                    </div>
                </div>
                
                <!-- ë¹›ë‚˜ëŠ” ì›ì„ -->
                <div class="bg-white bg-opacity-5 rounded-xl p-4 flex justify-between items-center">
                    <div>
                        <h3 class="text-lg font-bold text-white mb-1">âœ¨ ë¹›ë‚˜ëŠ” ì›ì„</h3>
                        <p class="text-gray-300 text-sm">ê· í˜•ì¡íŒ í™•ë¥ ì˜ ì›ì„ì…ë‹ˆë‹¤</p>
                        <p class="text-purple-300 font-medium">ğŸ’ 5 í”„ë¦¬ì¦˜ | ğŸ’ 50 í”„ë¦¬ì¦˜ (10íšŒ)</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="startGacha('normal')" class="bg-purple-500 hover:bg-purple-600 px-4 py-2 rounded-full text-white font-bold transition-all duration-300">
                            1íšŒ ë½‘ê¸°
                        </button>
                        <button onclick="startGacha('normal', 10)" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-full text-white font-bold transition-all duration-300">
                            10íšŒ ë½‘ê¸°
                        </button>
                    </div>
                </div>
                
                <!-- ì˜ë¡±í•œ ì›ì„ -->
                <div class="bg-white bg-opacity-5 rounded-xl p-4 flex justify-between items-center">
                    <div>
                        <h3 class="text-lg font-bold text-white mb-1">ğŸŒŸ ì˜ë¡±í•œ ì›ì„</h3>
                        <p class="text-gray-300 text-sm">ê³ ê¸‰ ë³´ì„ì´ ë” ì˜ ë‚˜ì˜¤ëŠ” ì›ì„ì…ë‹ˆë‹¤</p>
                        <p class="text-purple-300 font-medium">ğŸ’ 30 í”„ë¦¬ì¦˜ | ğŸ’ 300 í”„ë¦¬ì¦˜ (10íšŒ)</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="startGacha('premium')" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 px-4 py-2 rounded-full text-white font-bold transition-all duration-300">
                            1íšŒ ë½‘ê¸°
                        </button>
                        <button onclick="startGacha('premium', 10)" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 px-4 py-2 rounded-full text-white font-bold transition-all duration-300">
                            10íšŒ ë½‘ê¸°
                        </button>
                    </div>
                </div>
                
                <!-- ê´‘ì•ˆì˜ ì›ì„ -->
                <div class="bg-white bg-opacity-5 rounded-xl p-4 flex justify-between items-center">
                    <div>
                        <h3 class="text-lg font-bold text-white mb-1">ğŸ’« ê´‘ì•ˆì˜ ì›ì„</h3>
                        <p class="text-gray-300 text-sm">ìµœê³ ê¸‰ ë³´ì„ì´ íŠ¹ë³„í•œ í™•ë¥ ë¡œ ë‚˜ì˜¤ëŠ” ì›ì„ì…ë‹ˆë‹¤</p>
                        <p class="text-purple-300 font-medium">ğŸ’ 40 í”„ë¦¬ì¦˜ | ğŸ’ 400 í”„ë¦¬ì¦˜ (10íšŒ)</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="startGacha('luxury')" class="bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-500 hover:to-orange-600 px-4 py-2 rounded-full text-white font-bold transition-all duration-300">
                            1íšŒ ë½‘ê¸°
                        </button>
                        <button onclick="startGacha('luxury', 10)" class="bg-gradient-to-r from-yellow-500 to-orange-600 hover:from-yellow-600 hover:to-orange-700 px-4 py-2 rounded-full text-white font-bold transition-all duration-300">
                            10íšŒ ë½‘ê¸°
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ë³¼ë¥¨ ìƒì  í™”ë©´ -->
    <div id="volumeShopScreen" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 opacity-0 pointer-events-none transition-all duration-500">
        <div class="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl w-11/12 max-w-2xl p-6">
            <!-- ë³¼ë¥¨ ìƒì  í—¤ë” -->
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl sm:text-3xl font-bold text-white">ğŸ“¦ ë³¼ë¥¨ ìƒì </h2>
                <button id="closeVolumeShopBtn" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-full text-white font-bold transition-all duration-300">
                    âœ• ë‹«ê¸°
                </button>
            </div>
            
            <!-- ë³¼ë¥¨ ëª©ë¡ -->
            <div class="space-y-4">
                <!-- ë©€í‹° ë³¼ë¥¨ -->
                <div class="bg-white bg-opacity-5 rounded-xl p-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-bold text-white mb-1">ğŸ”¢ ë©€í‹° ë³¼ë¥¨</h3>
                            <p class="text-gray-300 text-sm mb-2">ì¥ì°©í•œ ë³´ì„ì˜ ë°°ìœ¨ì„ í•©ì—°ì‚°ìœ¼ë¡œ ë”í•´ì¤ë‹ˆë‹¤</p>
                            <p class="text-blue-300 font-medium">ğŸ’° 100,000 í¬ì¸íŠ¸</p>
                            <p id="multiVolumeStatus" class="text-xs text-gray-400 mt-1">ë¯¸ë³´ìœ </p>
                        </div>
                        <button id="buyMultiVolumeBtn" onclick="buyVolume('multi')" class="bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 px-4 py-2 rounded-full text-white font-bold transition-all duration-300">
                            êµ¬ë§¤
                        </button>
                    </div>
                </div>
                
                <!-- ì½”ëŸ¬ìŠ¤ ë³¼ë¥¨ -->
                <div class="bg-white bg-opacity-5 rounded-xl p-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-bold text-white mb-1">ğŸµ ì½”ëŸ¬ìŠ¤ ë³¼ë¥¨</h3>
                            <p class="text-gray-300 text-sm mb-2">ì¥ì°©í•œ ë³´ì„ì˜ ì½”ëŸ¬ìŠ¤ë¥¼ ë”í•´ì¤ë‹ˆë‹¤</p>
                            <p class="text-blue-300 font-medium">ğŸ’° 55,000 í¬ì¸íŠ¸</p>
                            <p id="chorusVolumeStatus" class="text-xs text-gray-400 mt-1">ë¯¸ë³´ìœ </p>
                        </div>
                        <button id="buyChorusVolumeBtn" onclick="buyVolume('chorus')" class="bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 px-4 py-2 rounded-full text-white font-bold transition-all duration-300">
                            êµ¬ë§¤
                        </button>
                    </div>
                </div>
                
                <!-- ëŸ­ìŠ¤ ë³¼ë¥¨ -->
                <div class="bg-white bg-opacity-5 rounded-xl p-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-bold text-white mb-1">âœ¨ ëŸ­ìŠ¤ ë³¼ë¥¨</h3>
                            <p class="text-gray-300 text-sm mb-2">ì¥ì°©í•œ ë³´ì„ì˜ íœ˜ê´‘ í™•ë¥ ì„ ë”í•´ì¤ë‹ˆë‹¤</p>
                            <p class="text-purple-300 font-medium">ğŸ’ 100 í”„ë¦¬ì¦˜</p>
                            <p id="luxVolumeStatus" class="text-xs text-gray-400 mt-1">ë¯¸ë³´ìœ </p>
                        </div>
                        <button id="buyLuxVolumeBtn" onclick="buyVolume('lux')" class="bg-gradient-to-r from-yellow-400 to-pink-500 hover:from-yellow-500 hover:to-pink-600 px-4 py-2 rounded-full text-white font-bold transition-all duration-300">
                            êµ¬ë§¤
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì¸ë²¤í† ë¦¬ í™”ë©´ -->
    <div id="inventoryScreen" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 opacity-0 pointer-events-none transition-all duration-500">
        <div class="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl w-11/12 max-w-4xl h-5/6 max-h-96 sm:max-h-screen sm:h-4/5 p-6 flex flex-col">
            <!-- ì¸ë²¤í† ë¦¬ í—¤ë” -->
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl sm:text-3xl font-bold text-white">ğŸ’ ì¸ë²¤í† ë¦¬</h2>
                <button id="closeInventoryBtn" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-full text-white font-bold transition-all duration-300">
                    âœ• ë‹«ê¸°
                </button>
            </div>
            
            <!-- ì¸ë²¤í† ë¦¬ ë‚´ìš© -->
            <div class="flex flex-1 gap-6 overflow-hidden">
                <!-- ì¢Œì¸¡: ë³´ì„ ë¦¬ìŠ¤íŠ¸ -->
                <div class="w-1/2 bg-white bg-opacity-5 rounded-xl p-4 overflow-y-auto">
                    <h3 class="text-lg font-bold text-white mb-4">ë³´ì„ ëª©ë¡</h3>
                    <div id="gemList" class="grid grid-cols-3 sm:grid-cols-4 gap-3">
                        <!-- ë³´ì„ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </div>
                </div>
                
                <!-- ìš°ì¸¡: ë³´ì„ ìƒì„¸ ì •ë³´ ë° ì¥ì°© ìŠ¬ë¡¯ -->
                <div class="w-1/2 bg-white bg-opacity-5 rounded-xl p-4 overflow-y-auto">
                    <!-- ì¥ì°© ìŠ¬ë¡¯ -->
                    <div class="mb-6">
                        <h3 class="text-lg font-bold text-white mb-3">ì¥ì°© ìŠ¬ë¡¯</h3>
                        <div id="equipmentSlots" class="grid grid-cols-2 gap-2 mb-4">
                            <!-- ì¥ì°© ìŠ¬ë¡¯ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </div>
                        <div class="text-xs text-gray-400">
                            <span id="slotInfo">ìŠ¬ë¡¯ 0/1 ì‚¬ìš© ì¤‘</span>
                        </div>
                    </div>
                    
                    <!-- ë³´ì„ ìƒì„¸ ì •ë³´ -->
                    <div id="gemDetails" class="text-center text-white">
                        <div class="text-6xl mb-4">ğŸ’</div>
                        <h3 class="text-xl font-bold mb-2">ë³´ì„ì„ ì„ íƒí•˜ì„¸ìš”</h3>
                        <p class="text-gray-300">ì¢Œì¸¡ì—ì„œ ë³´ì„ì„ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì„¤ì • í™”ë©´ -->
    <div id="settingsScreen" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 opacity-0 pointer-events-none transition-all duration-500">
        <div class="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl w-11/12 max-w-md p-6">
            <!-- ì„¤ì • í—¤ë” -->
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl sm:text-3xl font-bold text-white">âš™ï¸ ì„¤ì •</h2>
                <button id="closeSettingsBtn" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-full text-white font-bold transition-all duration-300">
                    âœ• ë‹«ê¸°
                </button>
            </div>
            
            <!-- ì„¤ì • ì˜µì…˜ë“¤ -->
            <div class="space-y-4">
                <!-- ì„œë²„ ìƒíƒœ -->
                <div class="bg-white bg-opacity-5 rounded-xl p-4">
                    <h3 class="text-lg font-bold text-white mb-2">ğŸŒ ì„œë²„ ìƒíƒœ</h3>
                    <div id="serverStatus" class="text-gray-300 text-sm">
                        <p>ì—°ê²° í™•ì¸ ì¤‘...</p>
                    </div>
                </div>
                
                <!-- ì‚¬ìš©ì ID -->
                <div class="bg-white bg-opacity-5 rounded-xl p-4">
                    <h3 class="text-lg font-bold text-white mb-2">ğŸ‘¤ ì‚¬ìš©ì ì •ë³´</h3>
                    <div id="userInfo" class="text-gray-300 text-sm">
                        <p>ì‚¬ìš©ì ID: <span id="userIdDisplay">ë¡œë”© ì¤‘...</span></p>
                    </div>
                </div>
                
                <!-- ë””ë²„ê·¸ ì •ë³´ -->
                <div class="bg-white bg-opacity-5 rounded-xl p-4">
                    <h3 class="text-lg font-bold text-white mb-2">ğŸ”§ ë””ë²„ê·¸ ì •ë³´</h3>
                    <div id="debugInfo" class="text-gray-300 text-xs">
                        <p>API URL: <span id="apiUrlDisplay">ë¡œë”© ì¤‘...</span></p>
                        <p>ë§ˆì§€ë§‰ API í˜¸ì¶œ: <span id="lastApiCall">ì—†ìŒ</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API ì„¤ì • - ë¡œì»¬ ê°œë°œìš©ìœ¼ë¡œ ë³€ê²½ (CORS ë¬¸ì œ í•´ê²°)
        const API_BASE_URL = 'https://gem-gacha-game2.onrender.com';

        // ê²Œì„ ìƒíƒœ ë³€ìˆ˜
        let currentUserId = null;
        let gameData = {
            points: 0,
            prisms: 0,
            inventory: {},
            volumes: { multi: false, chorus: false, lux: false },
            equippedGems: []
        };
        let isGachaActive = false;
        let currentGachaResults = [];

        // ë³´ì„ ë°ì´í„° (ë°±ì—”ë“œì™€ ë™ì¼)
        const gemData = {
            1: { name: 'ì‘ì€ ìˆ˜ì •', emoji: 'ğŸ’', chorus: 1, multiple: 1, lux: 0 },
            2: { name: 'í‘¸ë¥¸ ìˆ˜ì •', emoji: 'ğŸ”·', chorus: 2, multiple: 1, lux: 0 },
            3: { name: 'ë¶‰ì€ ìˆ˜ì •', emoji: 'ğŸ”¶', chorus: 3, multiple: 1, lux: 0 },
            4: { name: 'ì—ë©”ë„ë“œ', emoji: 'ğŸ’š', chorus: 4, multiple: 1, lux: 0 },
            5: { name: 'ì‚¬íŒŒì´ì–´', emoji: 'ğŸ’™', chorus: 5, multiple: 1, lux: 0 },
            6: { name: 'ë£¨ë¹„', emoji: 'â¤ï¸', chorus: 6, multiple: 1, lux: 0 },
            7: { name: 'ììˆ˜ì •', emoji: 'ğŸ’œ', chorus: 7, multiple: 1.1, lux: 0 },
            8: { name: 'í™©ê¸ˆì„', emoji: 'ğŸ’›', chorus: 8, multiple: 1.2, lux: 0 },
            9: { name: 'ë‹¤ì´ì•„ëª¬ë“œ', emoji: 'ğŸ’', chorus: 9, multiple: 1.3, lux: 0 },
            10: { name: 'ì˜¤íŒ”', emoji: 'ğŸŒˆ', chorus: 10, multiple: 1.4, lux: 0.5 },
            11: { name: 'ì§„ì£¼', emoji: 'ğŸ¤', chorus: 11, multiple: 1.5, lux: 0.8 },
            12: { name: 'í† íŒŒì¦ˆ', emoji: 'ğŸ§¡', chorus: 12, multiple: 1.6, lux: 1.0 },
            13: { name: 'ë³„ì˜ ì¡°ê°', emoji: 'â­', chorus: 15, multiple: 2.0, lux: 2.5 },
            14: { name: 'ë‹¬ì˜ ëˆˆë¬¼', emoji: 'ğŸŒ™', chorus: 20, multiple: 2.5, lux: 4.0 },
            15: { name: 'íƒœì–‘ì˜ ì‹¬ì¥', emoji: 'â˜€ï¸', chorus: 25, multiple: 3.0, lux: 5.0 }
        };

        // DOM ìš”ì†Œë“¤
        const pointsDisplay = document.getElementById('points');
        const prismsDisplay = document.getElementById('prisms');
        const messageDiv = document.getElementById('message');

        // API í˜¸ì¶œ í•¨ìˆ˜ë“¤
        async function apiCall(endpoint, method = 'GET', data = null) {
            const fullUrl = `${API_BASE_URL}${endpoint}`;
            
            try {
                console.log(`ğŸ”„ API í˜¸ì¶œ: ${method} ${fullUrl}`);
                document.getElementById('lastApiCall').textContent = `${method} ${endpoint}`;
                
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    mode: 'cors'
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                    console.log('ğŸ“¤ ìš”ì²­ ë°ì´í„°:', data);
                }
                
                const response = await fetch(fullUrl, options);
                console.log(`ğŸ“¡ ì‘ë‹µ ìƒíƒœ: ${response.status} ${response.statusText}`);
                
                if (!response.ok) {
                    let errorMessage = `HTTP ${response.status}`;
                    try {
                        const errorText = await response.text();
                        console.error('âŒ API ì˜¤ë¥˜ ì‘ë‹µ:', errorText);
                        errorMessage += `: ${errorText}`;
                    } catch (e) {
                        console.error('âŒ ì˜¤ë¥˜ ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨:', e);
                    }
                    throw new Error(errorMessage);
                }
                
                const result = await response.json();
                console.log('âœ… API ì‘ë‹µ:', result);
                return result;
            } catch (error) {
                console.error('ğŸ’¥ API í˜¸ì¶œ ì‹¤íŒ¨:', error);
                
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    showMessage('ğŸŒ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•˜ì„¸ìš”.', 'text-red-300');
                } else if (error.message.includes('404')) {
                    showMessage('ğŸ” API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'text-red-300');
                } else if (error.message.includes('500')) {
                    showMessage('ğŸ”§ ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'text-red-300');
                } else {
                    showMessage(`âŒ ì„œë²„ ì˜¤ë¥˜: ${error.message}`, 'text-red-300');
                }
                throw error;
            }
        }

        // ë¡œê·¸ì¸ í•¨ìˆ˜
        async function login() {
            const loginBtn = document.getElementById('loginBtn');
            const loginLoading = document.getElementById('loginLoading');
            const loginError = document.getElementById('loginError');
            
            loginBtn.style.display = 'none';
            loginLoading.classList.remove('hidden');
            loginError.classList.add('hidden');
            
            try {
                // ê¸°ì¡´ ì‚¬ìš©ì ID í™•ì¸
                const savedUserId = localStorage.getItem('gemGachaUserId');
                console.log('ğŸ’¾ ì €ì¥ëœ ì‚¬ìš©ì ID:', savedUserId);
                
                const response = await apiCall('/api/auth/login', 'POST', {
                    userId: savedUserId
                });
                
                if (response.success) {
                    currentUserId = response.userId;
                    localStorage.setItem('gemGachaUserId', currentUserId);
                    console.log('âœ… ë¡œê·¸ì¸ ì„±ê³µ:', currentUserId);
                    
                    // ê²Œì„ ë°ì´í„° ë¡œë“œ
                    await loadGameData();
                    
                    // ë¡œê·¸ì¸ í™”ë©´ ìˆ¨ê¸°ê³  ë©”ì¸ UI í‘œì‹œ
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('mainUI').style.opacity = '1';
                    
                    showMessage('ğŸ® ê²Œì„ì— ì ‘ì†í–ˆìŠµë‹ˆë‹¤!', 'text-green-300');
                } else {
                    throw new Error('ë¡œê·¸ì¸ ì‘ë‹µì´ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ğŸ’¥ ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
                loginBtn.style.display = 'block';
                loginLoading.classList.add('hidden');
                loginError.classList.remove('hidden');
                
                // ë” êµ¬ì²´ì ì¸ ì˜¤ë¥˜ ë©”ì‹œì§€
                let errorText = '';
                if (error.message.includes('Failed to fetch')) {
                    errorText = 'ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.';
                } else if (error.message.includes('CORS')) {
                    errorText = 'CORS ì˜¤ë¥˜: ë°±ì—”ë“œ ì„œë²„ì˜ CORS ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.';
                } else if (error.message.includes('404')) {
                    errorText = 'API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë°±ì—”ë“œ ë¼ìš°í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”.';
                } else {
                    errorText = `ë¡œê·¸ì¸ ì‹¤íŒ¨: ${error.message}`;
                }
                
                loginError.textContent = errorText;
                showMessage('âŒ ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'text-red-300');
            }
        }

        // ê²Œì„ ë°ì´í„° ë¡œë“œ
        async function loadGameData() {
            try {
                console.log('ğŸ“Š ê²Œì„ ë°ì´í„° ë¡œë“œ ì‹œì‘:', currentUserId);
                const data = await apiCall(`/api/user/gamedata/${currentUserId}`);
                gameData = data;
                updateDisplay();
                updateEquippedGemDisplay();
                updateVolumeShopDisplay();
                
                // ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
                document.getElementById('userIdDisplay').textContent = currentUserId.substring(0, 8) + '...';
                console.log('âœ… ê²Œì„ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
            } catch (error) {
                console.error('ğŸ’¥ ê²Œì„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                showMessage('ğŸ“Š ê²Œì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'text-red-300');
            }
        }

        // í™”ë©´ ì—…ë°ì´íŠ¸
        function updateDisplay() {
            pointsDisplay.textContent = gameData.points.toLocaleString();
            prismsDisplay.textContent = gameData.prisms.toLocaleString();
        }

        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(text, color = 'text-white') {
            messageDiv.textContent = text;
            messageDiv.className = `mt-6 sm:mt-8 text-center font-medium text-base sm:text-lg transition-opacity duration-300 px-4 ${color}`;
            messageDiv.style.opacity = '1';
            
            setTimeout(() => {
                messageDiv.style.opacity = '0';
            }, 3000);
        }

        // í¬ì¸íŠ¸ íšë“
        async function earnPoints() {
            if (isGachaActive || !currentUserId) return;
            
            try {
                const response = await apiCall('/api/user/earn-points', 'POST', {
                    userId: currentUserId
                });
                
                gameData.points = response.newPoints;
                gameData.prisms = response.newPrisms;
                updateDisplay();
                
                if (response.prismsEarned > 0) {
                    showMessage(`ğŸ’° ${response.earnedPoints} í¬ì¸íŠ¸ + íœ˜ê´‘ìœ¼ë¡œ í”„ë¦¬ì¦˜ 1ê°œ íšë“!`, 'text-purple-300');
                } else {
                    showMessage(`ğŸ’° ${response.earnedPoints} í¬ì¸íŠ¸ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!`, 'text-blue-300');
                }
            } catch (error) {
                console.error('ğŸ’¥ í¬ì¸íŠ¸ íšë“ ì‹¤íŒ¨:', error);
            }
        }

        // ë½‘ê¸° ì‹œì‘
        async function startGacha(type, count = 1) {
            if (isGachaActive || !currentUserId) return;
            
            try {
                const response = await apiCall('/api/gacha/draw', 'POST', {
                    userId: currentUserId,
                    type,
                    count
                });
                
                if (response.success) {
                    // ê²Œì„ ë°ì´í„° ì—…ë°ì´íŠ¸
                    gameData.points = response.newPoints;
                    gameData.prisms = response.newPrisms;
                    gameData.inventory = response.newInventory;
                    updateDisplay();
                    
                    // ë½‘ê¸° ê²°ê³¼ ì €ì¥
                    currentGachaResults = response.results;
                    window.currentGachaCount = count;
                    
                    // ìƒì  í™”ë©´ ë‹«ê¸°
                    closeAllShops();
                    
                    // ë½‘ê¸° ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
                    startGachaAnimation();
                } else {
                    showMessage('ğŸ² ë½‘ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'text-red-300');
                }
            } catch (error) {
                console.error('ğŸ’¥ ë½‘ê¸° ì‹¤íŒ¨:', error);
            }
        }

        // ë³¼ë¥¨ êµ¬ë§¤
        async function buyVolume(type) {
            if (!currentUserId) return;
            
            try {
                const response = await apiCall('/api/user/buy-volume', 'POST', {
                    userId: currentUserId,
                    type
                });
                
                if (response.success) {
                    gameData.volumes = response.volumes;
                    gameData.points = response.points;
                    gameData.prisms = response.prisms;
                    updateDisplay();
                    updateVolumeShopDisplay();
                    showMessage(`ğŸ›’ ${getVolumeKoreanName(type)}ì„(ë¥¼) êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤!`, 'text-green-300');
                }
            } catch (error) {
                console.error('ğŸ’¥ ë³¼ë¥¨ êµ¬ë§¤ ì‹¤íŒ¨:', error);
                showMessage('ğŸ›’ êµ¬ë§¤ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'text-red-300');
            }
        }

        // ë³´ì„ ì¥ì°©/í•´ì œ
        async function equipGem(gemId, action = 'equip') {
            if (!currentUserId) return;
            
            try {
                const response = await apiCall('/api/user/equip-gem', 'POST', {
                    userId: currentUserId,
                    gemId,
                    action
                });
                
                if (response.success) {
                    gameData.equippedGems = response.equippedGems;
                    updateEquippedGemDisplay();
                    updateInventoryDisplay();
                    showGemDetails(gemId);
                    
                    const gem = gemData[gemId];
                    if (action === 'equip') {
                        showMessage(`ğŸ’ ${gem.name}ì„(ë¥¼) ì¥ì°©í–ˆìŠµë‹ˆë‹¤!`, 'text-green-300');
                    } else {
                        showMessage(`ğŸ’ ${gem.name} ì¥ì°©ì„ í•´ì œí–ˆìŠµë‹ˆë‹¤!`, 'text-yellow-300');
                    }
                }
            } catch (error) {
                console.error('ğŸ’¥ ë³´ì„ ì¥ì°©/í•´ì œ ì‹¤íŒ¨:', error);
            }
        }

        // ë³´ì„ ì¶”ì¶œ
        async function extractGem(gemId) {
            if (!currentUserId) return;
            
            try {
                const response = await apiCall('/api/user/extract-gem', 'POST', {
                    userId: currentUserId,
                    gemId
                });
                
                if (response.success) {
                    gameData.prisms = response.newPrisms;
                    gameData.inventory = response.newInventory;
                    updateDisplay();
                    updateInventoryDisplay();
                    showGemDetails(gemId);
                    
                    const gem = gemData[gemId];
                    showMessage(`ğŸ’ ${gem.name}ì„(ë¥¼) ì¶”ì¶œí•˜ì—¬ í”„ë¦¬ì¦˜ ${response.prismReward}ê°œë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!`, 'text-purple-300');
                }
            } catch (error) {
                console.error('ğŸ’¥ ë³´ì„ ì¶”ì¶œ ì‹¤íŒ¨:', error);
            }
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function getVolumeKoreanName(type) {
            const names = { multi: 'ë©€í‹° ë³¼ë¥¨', chorus: 'ì½”ëŸ¬ìŠ¤ ë³¼ë¥¨', lux: 'ëŸ­ìŠ¤ ë³¼ë¥¨' };
            return names[type] || 'ë³¼ë¥¨';
        }

        function getGemGrade(gemId) {
            const gemRewards = {
                'ì¼ë°˜': [1, 2, 3],
                'í¬ê·€': [4, 5, 6], 
                'ì—í”½': [7, 8, 9],
                'ì „ì„¤': [10, 11, 12],
                'ìœ ë‹ˆí¬': [13, 14, 15]
            };
            
            for (const [grade, gemIds] of Object.entries(gemRewards)) {
                if (gemIds.includes(parseInt(gemId))) {
                    return grade;
                }
            }
            return 'ì¼ë°˜';
        }

        function closeAllShops() {
            document.getElementById('shopScreen').style.opacity = '0';
            document.getElementById('shopScreen').style.pointerEvents = 'none';
            document.getElementById('gachaShopScreen').style.opacity = '0';
            document.getElementById('gachaShopScreen').style.pointerEvents = 'none';
            document.getElementById('volumeShopScreen').style.opacity = '0';
            document.getElementById('volumeShopScreen').style.pointerEvents = 'none';
        }

        // ë½‘ê¸° ì• ë‹ˆë©”ì´ì…˜ ë° UI í•¨ìˆ˜ë“¤
        function startGachaAnimation() {
            isGachaActive = true;
            
            const mainUI = document.getElementById('mainUI');
            const gachaScreen = document.getElementById('gachaScreen');
            const gemstone = document.getElementById('gemstone');
            const gachaText = document.getElementById('gachaText');
            
            mainUI.style.opacity = '0';
            gachaScreen.style.opacity = '1';
            gachaScreen.style.pointerEvents = 'auto';
            
            if (window.currentGachaCount === 10) {
                gachaText.textContent = 'ì›ì„ì„ í´ë¦­í•˜ì„¸ìš”! (10íšŒ ë½‘ê¸°)';
            } else {
                gachaText.textContent = 'ì›ì„ì„ í´ë¦­í•˜ì„¸ìš”!';
            }
            
            gemstone.onclick = () => {
                if (window.currentGachaCount === 10) {
                    performMultipleGacha();
                } else {
                    revealGrade();
                }
            };
        }

        function performMultipleGacha() {
            // ê°€ì¥ ë†’ì€ ë“±ê¸‰ ì°¾ê¸°
            const gradeOrder = ['ì¼ë°˜', 'í¬ê·€', 'ì—í”½', 'ì „ì„¤', 'ìœ ë‹ˆí¬'];
            let highestGrade = 'ì¼ë°˜';
            let highestGradeClass = 'grade-common';
            
            currentGachaResults.forEach(result => {
                const currentIndex = gradeOrder.indexOf(result.grade);
                const highestIndex = gradeOrder.indexOf(highestGrade);
                if (currentIndex > highestIndex) {
                    highestGrade = result.grade;
                    highestGradeClass = getGradeClass(result.grade);
                }
            });
            
            showGradeReveal(highestGrade, highestGradeClass, true);
        }

        function revealGrade() {
            const result = currentGachaResults[0];
            showGradeReveal(result.grade, getGradeClass(result.grade), false);
        }

        function getGradeClass(grade) {
            const gradeClasses = {
                'ì¼ë°˜': 'grade-common',
                'í¬ê·€': 'grade-rare',
                'ì—í”½': 'grade-epic',
                'ì „ì„¤': 'grade-legendary',
                'ìœ ë‹ˆí¬': 'grade-unique'
            };
            return gradeClasses[grade] || 'grade-common';
        }

        function showGradeReveal(gradeName, gradeClass, isMultiple) {
            const gachaScreen = document.getElementById('gachaScreen');
            const revealScreen = document.getElementById('revealScreen');
            const gradeText = document.getElementById('gradeText');
            const revealMessage = document.getElementById('revealMessage');

            gachaScreen.style.opacity = '0';
            gachaScreen.style.pointerEvents = 'none';

            setTimeout(() => {
                revealScreen.style.opacity = '1';
                revealScreen.style.pointerEvents = 'auto';
                revealScreen.className = `fixed inset-0 flex items-center justify-center z-50 transition-all duration-1000 ${gradeClass}`;
                gradeText.textContent = gradeName;
                
                if (isMultiple) {
                    revealMessage.textContent = `ìµœê³  ë“±ê¸‰: ${gradeName}!`;
                } else {
                    revealMessage.textContent = 'ë“±ê¸‰ì´ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤!';
                }
            }, 500);
        }

        // ìƒì  ê´€ë ¨ í•¨ìˆ˜ë“¤
        function openGachaShop() {
            document.getElementById('shopScreen').style.opacity = '0';
            document.getElementById('shopScreen').style.pointerEvents = 'none';
            document.getElementById('gachaShopScreen').style.opacity = '1';
            document.getElementById('gachaShopScreen').style.pointerEvents = 'auto';
        }

        function openVolumeShop() {
            document.getElementById('shopScreen').style.opacity = '0';
            document.getElementById('shopScreen').style.pointerEvents = 'none';
            document.getElementById('volumeShopScreen').style.opacity = '1';
            document.getElementById('volumeShopScreen').style.pointerEvents = 'auto';
        }

        // ë¹ˆ í•¨ìˆ˜ë“¤ (ë‚˜ì¤‘ì— êµ¬í˜„)
        function updateEquippedGemDisplay() {
            // TODO: ì¥ì°©ëœ ë³´ì„ í‘œì‹œ ì—…ë°ì´íŠ¸
        }

        function updateInventoryDisplay() {
            // TODO: ì¸ë²¤í† ë¦¬ í‘œì‹œ ì—…ë°ì´íŠ¸
        }

        function updateVolumeShopDisplay() {
            // TODO: ë³¼ë¥¨ ìƒì  í‘œì‹œ ì—…ë°ì´íŠ¸
        }

        function showGemDetails(gemId) {
            // TODO: ë³´ì„ ìƒì„¸ ì •ë³´ í‘œì‹œ
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
        document.getElementById('loginBtn').addEventListener('click', login);
        document.getElementById('earnPointsBtn').addEventListener('click', earnPoints);
        
        // ìƒì  ê´€ë ¨ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
        document.getElementById('shopBtn').addEventListener('click', () => {
            if (isGachaActive) return;
            document.getElementById('shopScreen').style.opacity = '1';
            document.getElementById('shopScreen').style.pointerEvents = 'auto';
        });

        document.getElementById('closeShopBtn').addEventListener('click', () => {
            document.getElementById('shopScreen').style.opacity = '0';
            document.getElementById('shopScreen').style.pointerEvents = 'none';
        });

        document.getElementById('closeGachaShopBtn').addEventListener('click', () => {
            document.getElementById('gachaShopScreen').style.opacity = '0';
            document.getElementById('gachaShopScreen').style.pointerEvents = 'none';
        });

        document.getElementById('closeVolumeShopBtn').addEventListener('click', () => {
            document.getElementById('volumeShopScreen').style.opacity = '0';
            document.getElementById('volumeShopScreen').style.pointerEvents = 'none';
        });

        // ì„¤ì • ê´€ë ¨ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
        document.getElementById('settingsBtn').addEventListener('click', () => {
            document.getElementById('settingsScreen').style.opacity = '1';
            document.getElementById('settingsScreen').style.pointerEvents = 'auto';
        });

        document.getElementById('closeSettingsBtn').addEventListener('click', () => {
            document.getElementById('settingsScreen').style.opacity = '0';
            document.getElementById('settingsScreen').style.pointerEvents = 'none';
        });

        // ì¸ë²¤í† ë¦¬ ê´€ë ¨ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
        document.getElementById('inventoryBtn').addEventListener('click', () => {
            document.getElementById('inventoryScreen').style.opacity = '1';
            document.getElementById('inventoryScreen').style.pointerEvents = 'auto';
        });

        document.getElementById('closeInventoryBtn').addEventListener('click', () => {
            document.getElementById('inventoryScreen').style.opacity = '0';
            document.getElementById('inventoryScreen').style.pointerEvents = 'none';
        });

        // ë½‘ê¸° ê²°ê³¼ í™”ë©´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
        document.getElementById('continueBtn').addEventListener('click', () => {
            showGemReward();
        });

        document.getElementById('finalContinueBtn').addEventListener('click', () => {
            endGacha();
        });

        function showGemReward() {
            const revealScreen = document.getElementById('revealScreen');
            const gemRewardScreen = document.getElementById('gemRewardScreen');
            
            revealScreen.style.opacity = '0';
            revealScreen.style.pointerEvents = 'none';
            
            setTimeout(() => {
                if (window.currentGachaCount === 10) {
                    showMultipleGemReward();
                } else {
                    showSingleGemReward();
                }
                
                gemRewardScreen.style.opacity = '1';
                gemRewardScreen.style.pointerEvents = 'auto';
            }, 500);
        }

        function showSingleGemReward() {
            const result = currentGachaResults[0];
            const gem = gemData[result.gemId];
            
            document.getElementById('singleReward').classList.remove('hidden');
            document.getElementById('multipleReward').classList.add('hidden');
            
            document.getElementById('rewardGemImage').textContent = gem.emoji;
            document.getElementById('rewardText').textContent = `${gem.name} íšë“!`;
        }

        function showMultipleGemReward() {
            document.getElementById('singleReward').classList.add('hidden');
            document.getElementById('multipleReward').classList.remove('hidden');
            
            const grid = document.getElementById('multipleGemGrid');
            grid.innerHTML = '';
            
            currentGachaResults.forEach(result => {
                const gem = gemData[result.gemId];
                const gemDiv = document.createElement('div');
                gemDiv.className = 'bg-white bg-opacity-10 rounded-lg p-3 text-center';
                gemDiv.innerHTML = `
                    <div class="text-2xl mb-1">${gem.emoji}</div>
                    <div class="text-xs text-white">${gem.name}</div>
                `;
                grid.appendChild(gemDiv);
            });
        }

        function endGacha() {
            const gemRewardScreen = document.getElementById('gemRewardScreen');
            const mainUI = document.getElementById('mainUI');
            
            gemRewardScreen.style.opacity = '0';
            gemRewardScreen.style.pointerEvents = 'none';
            
            setTimeout(() => {
                mainUI.style.opacity = '1';
                isGachaActive = false;
                currentGachaResults = [];
                window.currentGachaCount = 1;
            }, 500);
        }

        // ì„œë²„ ìƒíƒœ í™•ì¸
        async function checkServerStatus() {
            try {
                console.log('ğŸ” ì„œë²„ ìƒíƒœ í™•ì¸ ì‹œì‘');
                
                // ë¨¼ì € ê°„ë‹¨í•œ ping í…ŒìŠ¤íŠ¸
                const response = await fetch(`${API_BASE_URL}/api/ping`, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('serverStatus').innerHTML = `
                        <p class="text-green-400">âœ… ì„œë²„ ì—°ê²°ë¨</p>
                        <p class="text-xs text-gray-400">${data.message || 'ì„œë²„ê°€ ì •ìƒ ì‘ë™ ì¤‘ì…ë‹ˆë‹¤'}</p>
                        <p class="text-xs text-blue-300">ì‘ë‹µ ì‹œê°„: ${Date.now() - window.pingStartTime}ms</p>
                    `;
                    console.log('âœ… ì„œë²„ ìƒíƒœ í™•ì¸ ì™„ë£Œ');
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.error('ğŸ’¥ ì„œë²„ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
                
                let errorMessage = '';
                if (error.message.includes('CORS')) {
                    errorMessage = 'CORS ì •ì±…ìœ¼ë¡œ ì¸í•œ ì°¨ë‹¨ - ë°±ì—”ë“œ ì„œë²„ ì„¤ì • í™•ì¸ í•„ìš”';
                } else if (error.message.includes('Failed to fetch')) {
                    errorMessage = 'ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŒ - ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸';
                } else {
                    errorMessage = error.message;
                }
                
                document.getElementById('serverStatus').innerHTML = `
                    <p class="text-red-400">âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨</p>
                    <p class="text-xs text-gray-400">ë°±ì—”ë“œ ì„œë²„ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
                    <p class="text-xs text-red-300">${errorMessage}</p>
                    <div class="mt-2 text-xs text-yellow-300">
                        <p>ğŸ’¡ í•´ê²° ë°©ë²•:</p>
                        <p>1. ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸</p>
                        <p>2. CORS ì„¤ì •ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸</p>
                        <p>3. API URLì´ ì •í™•í•œì§€ í™•ì¸</p>
                    </div>
                `;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            
            // ë””ë²„ê·¸ ì •ë³´ í‘œì‹œ
            document.getElementById('apiUrlDisplay').textContent = API_BASE_URL;
            
            // ì„œë²„ ìƒíƒœ í™•ì¸ (íƒ€ì´ë° ì¸¡ì •)
            window.pingStartTime = Date.now();
            checkServerStatus();
            
            console.log('ğŸ® ê²Œì„ ì´ˆê¸°í™” ì™„ë£Œ');
        });
        
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'977d507b56a4306e',t:'MTc1NjY1MTU1NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
